# Tóm Tắt Thiết Kế Hệ Thống Review Code AI & RAG

| Thành phần chính | Mô tả chức năng | Công nghệ/Kỹ thuật nổi bật | Tối ưu hóa liên quan |
|---|---|---|---|
| **Frontend (Web UI)** | Giao diện tương tác cho người dùng tải file/dán code, **hỗ trợ chọn danh mục review (bảo mật, clean code, v.v.) qua checkbox**, và hiển thị báo cáo review. | React.js, Tailwind CSS, API FileReader | Giao diện thân thiện, hỗ trợ đa file, tùy chỉnh phạm vi review. |
| **Backend (API Server)** | Điều phối luồng review, xử lý input (hỗ trợ đa file và **danh mục review đã chọn**), tương tác với RAG/LLM, định dạng output. | Python (FastAPI/Flask) | Xử lý song song (concurrency) cho nhiều file, tiền lọc quy tắc đơn giản, lọc quy tắc theo danh mục. |
| **RAG/LLM Core** | Bộ não hệ thống: chứa cơ sở dữ liệu vector, mô hình embedding và mô hình ngôn ngữ lớn (LLM). | ChromaDB (qua Docker), Embedding Model (Ollama), LLM (Ollama Phi4) | RAG cung cấp ngữ cảnh, LLM nhỏ gọn (Phi4), chất lượng dữ liệu RAG. |
| **Dữ liệu RAG: Codebase** | Lưu trữ cấu trúc và ngữ nghĩa của toàn bộ codebase để LLM tham chiếu. | AST (Abstract Syntax Tree), Chunking, Embedding | Phân tích AST giúp truy vấn chính xác, chunking tối ưu token. |
| **Dữ liệu RAG: Checklist** | Chứa các quy tắc review cụ thể dưới dạng JSON để LLM áp dụng. **Các quy tắc được gán với các danh mục (category) tương ứng.** | File \*.json, Embedding | Quy tắc rõ ràng, không mâu thuẫn, hỗ trợ lọc theo danh mục. |
| **Quy trình Review Input** | Nhận file code hoặc đoạn code cần review, **các danh mục review được chọn**, phân tích AST và chia nhỏ (chunking). | FileReader (Frontend), AST parsing (Backend) | Xử lý từng file riêng lẻ rồi tổng hợp kết quả, chỉ xử lý các danh mục được chọn. |
| **Quy trình Truy vấn RAG** | Lấy về các quy tắc liên quan từ Checklist (chỉ những quy tắc thuộc các danh mục đã chọn) và các đoạn code mẫu từ Codebase. | Truy vấn ChromaDB (embedding similarity, có thể thêm lọc metadata theo category) | Đánh giá độ tương đồng để lấy thông tin liên quan nhất, tập trung vào các danh mục đã chọn. |
| **Quy trình Xây dựng Prompt** | Tạo prompt rõ ràng, cấu trúc cho LLM với code input, **các quy tắc thuộc danh mục đã chọn**, ngữ cảnh và yêu cầu đề xuất fix. | Prompt Engineering | Prompt chặt chẽ giúp giảm ảo giác, tăng độ chính xác, hướng dẫn LLM tập trung vào các khía cạnh mong muốn. |
| **Quy trình Output** | LLM trả về kết quả Markdown cho từng file/đoạn code, Backend tổng hợp lại. Đầu ra bao gồm trạng thái vi phạm/không, đề xuất sửa lỗi nếu có vi phạm, và các quy tắc được đánh số thứ tự. | Định dạng Markdown | Tổng hợp báo cáo Markdown chung cho nhiều file, định dạng rõ ràng bao gồm cả đề xuất sửa lỗi và số thứ tự quy tắc. |
| **Giảm thiểu Ảo giác** | Đảm bảo LLM chỉ sử dụng thông tin được cung cấp, không suy diễn. | Prompt Engineering, Chất lượng dữ liệu RAG, Ngưỡng tương đồng RAG | Các ràng buộc trong prompt, dữ liệu RAG chuẩn xác. |
